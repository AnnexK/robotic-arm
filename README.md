# Моделирование процесса поиска оптимальной траектории перемещения робота-манипулятора на основе алгоритма муравьиных колоний #


## Необходимое ПО ##

+ Python 3.7+ [Скачать Python](http://python.org/downloads/)
  + numpy
  + pybullet 2.5.5
  + matplotlib

> **Важно!** Windows XP и ранее не поддерживаются, начиная с Python 3.5.

Для установки библиотек numpy, pybullet, matplotlib воспользуйтесь утилитой `pip`, поставляемой в комплекте с Python 3:

```
pip3 install --user numpy pybullet matplotlib
```

или

```
python3 -m pip install --user numpy pybullet matplotlib
```

(Linux)

```
py -m pip install --user numpy pybullet matplotlib
```

(Windows)

> Для сборки библиотеки PyBullet под Windows необходимо установить [средства сборки MS Visual C++](https://visualstudio.microsoft.com/ru/downloads/)
> (Все скачиваемые файлы -> Инструменты для Visual Studio 2019 -> Build Tools для Visual Studio 2019)

Запуск
------

Для запуска приложения запустите скрипт `main.py` следующим образом:

```
python3 main.py <опции> <имя-файла-задачи> <имя-файла-статистики> <имя-файла-последовательности-состояний>
```

Организация файлов задачи см. [Файлы задач, моделей и окружения](#files).

Файл статистики в формате CSV. В качестве разделителей используется запятая.
> При импорте файла в MS Office Excel или его аналоги сначала импортируйте все поля как текст, а затем замените во всех полях точки на запятые, иначе Excel будет воспринимать записи в файле как текст (или дату).
> (А еще лучше - используйте OpenOffice и установите локаль en_US.)

Файл последовательности состояний содержит строки, включающие в себя содержимое вектора обобщенных координат для каждого шага лучшего найденного пути.

Опции командной строки:

+ `-a`, `--alpha` : параметр, определяющий влияние кол-ва феромона на выбор (по умолчанию: 1.0)
+ `-b`, `--beta` : параметр, определяющий влияние веса ребра на выбор (по умолчанию: 1.0)
+ `-g`, `--gamma` : параметр, определяющий влияние направления движения относительно кратчайшего направления до конечной точки на выбор (по умолчанию: 0.0)
+ `-p`, `--phi` : начальный уровень феромона (по умолчанию: 0.1)
+ `-d`, `--decay` : скорость испарения феромона (по умолчанию: 0.01)
+ `-q`, `--ant-power` : количество феромона, откладываемое муравьем (по умолчанию : 1.0)
+ `-k`, `--ant-num` : количество муравьев (по умолчанию: 1)
+ `-i`, `-iters` : количество итераций (по умолчанию: 1)
+ `--limit` : ограничение на количество перемещений муравья (по умолчанию: 2.5E5)
+ `--plot` : построить график статистики после завершения процесса решения
+ `--silent` : запускает программу в режиме без графического отображения процесса поиска решения. Может быть полезно при работе на ЭВМ с одноядерным процессором или просто для уменьшения нагрузки
+ `--fallback` : запускает программу в режиме с графическим отображением процесса поиска решения с рендером OpenGL 2. Если программа вылетает, возможно, Ваш графический адаптер не поддерживает рендер OpenGL 3; в таком случае следует запустить программу с данной опцией.
> Две последние опции являются взаимоисключающими.

## Файлы задач, моделей и окружения ##
<a name="files">
</a>

В директории files расположены примеры файлов задач (test-task.json), моделей (test-model.urdf) и внешней среды (test-env.sdf).

### Файл задачи
Файл задачи содержит в себе данные задачи в формате JSON. В файле обязательно должны присутствовать следующие поля:

+ `urdf_name` : имя файла, содержащего описание модели робота
+ `effector_name` : идентификатор звена рабочего органа модели
+ `endpoint` : координаты конечной точки

Значения следующих полей при их отсутствии в файле будут заменены на значения по умолчанию:

+ `sdf_name` : имя файла, содержащего описание внешней среды робота; при отсутствии создается пустая внешняя среда
+ `eps` : точность вычислений ОКЗ / шаг сетки; значение по умолчанию -- 0.0001
+ `dofs` : начальные значения обобщенных координат; при отсутствии за начальные значения обобщенных координат принимаются значения, полученные из файла с описанием модели
+ `emp_best` : не используется

### Файл модели

Файл модели содержит данные о модели робота в формате [URDF](http://wiki.ros.org/urdf/XML).

### Файл внешней среды

Файл внешней среды содержит описание внешней среды робота в формате [SDF](http://sdformat.org/spec).
> **Важно.** Для того, чтобы объекты внешней среды были неперемещаемыми, к каждому описанию объекта (тег `model`) должно быть добавлено свойство `static`, установленное в 1:

```xml
<model name="m">
	<static>1</static>
</model>
```

## Графики ##

Хотя результат работы программы включает в себя вывод статистики процесса поиска в формате csv, который можно отобразить в графическом виде, например, с помощью MS Office Excel, программа также поддерживает вывод графической информации непосредственно после завершения поиска решений. Возможно сохранение полученной графической информации в формате PNG. Для вывода графиков после завершения процесса решения необходимо запустить скрипт ```main.py``` с ключом ```--plot```.

## Просмотр полученных решений ##

После завершения процесса поиска последовательность состояний модели робота сохраняется в файл. Чтобы просмотреть построенную траекторию, можно воспользоваться скриптом ```seq-viewer.py```, находящемся в корневой директории программы.

Для запуска просмотрщика решений запустите скрипт следующим образом:

```python3 seq-viewer.py <имя-файла-задачи> <имя-файла-последовательности> [--fps N]```

Параметр ```--fps``` задает количество состояний, отображаемых за секунду.
